<!DOCTYPE html>



<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <script src="/static/commonUtils.js"></script>
    <script>

        const uid = getUid();
        if (uid == null) {
            window.location.replace("/static/login.html");
        }

        async function getNewTask() {
            let data = sessionStorage.getItem("next_task_content");
            if (data == null) {
                const response = await fetch('/tasks/tasks' + "?uid=" + encodeURIComponent(uid));
                if (!response.ok) {
                    console.error("Failed to fetch new task");
                    return;
                }
                data = await response.json();
            } else {
                data = JSON.parse(data);
            }

            await sessionStorage.setItem("task_content", JSON.stringify(data));
            let taskType = data.task_type; // Get the task type
            let url;
            if (taskType === "Word2Explanation") {
                url = "/static/task_word2explanation.html";
            }
            else if (taskType === "MatchWordExplanation") {
                url = "/static/task_match.html";
            } else if (taskType === "SentenceWithPlaceholder") {
                url = "/static/task_typing.html";
            } else if (taskType === "NoNewWords") {
                url = "/static/no_new_words.html";
            }
            else {
                url = "/static/task_match.html"
                alert(`Unknow task type ${taskType}`);
            }
            url = url + "?uid=" + encodeURIComponent(uid);
            window.location.replace(url);

        }

        let cnt = parseInt(sessionStorage.getItem("completed_tasks")) || 0;
        cnt += 1;
        sessionStorage.setItem("completed_tasks", cnt);


        getNewTask();
    </script>

</body>
</html>